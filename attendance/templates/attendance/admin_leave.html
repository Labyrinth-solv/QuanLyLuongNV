{% extends "base_admin.html" %}


{% block admin_content %}
<div class="container mt-3">


    <h3 class="mb-4">Duyệt yêu cầu nghỉ phép</h3>
    <div class="card shadow-sm mb-5">
        <div class="card-body">
            <table class="table table-bordered table-striped">
                <thead class="table-primary">
                    <tr>
                        <th>Nhân viên</th>
                        <th>Ngày nghỉ</th>
                        <th>Lý do</th>
                        <th>Trạng thái</th>
                        <th>Duyệt</th>
                    </tr>
                </thead>
                <tbody>
                    {% for d in details %}
                    <tr>
                            <td>{{ d.staff_name }}</td>
                        <td>{{ d.leave_date }}</td>
                        <td>{{ d.reason }}</td>
                        <td>
                            {% if d.status == "Approved" %}
                                <span class="badge bg-success">Đã duyệt</span>
                            {% elif d.status == "Rejected" %}
                                <span class="badge bg-danger">Từ chối</span>
                            {% else %}
                                <span class="badge bg-warning text-dark">Chờ duyệt</span>
                            {% endif %}
                        </td>
                        <td>
                            <form method="post" class="d-flex gap-2">
                                {% csrf_token %}
                                <input type="hidden" name="detail_id" value="{{ d.detail_id }}">
                                <button type="submit" name="status" value="approve" class="btn btn-success btn-sm">Duyệt</button>
                                <button type="submit" name="status" value="reject" class="btn btn-danger btn-sm">Từ chối</button>
                            </form>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="5" class="text-center">Không có yêu cầu nào.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <form method="get">
    <label for="date">Chọn tháng:</label>
    <input type="date" id="date" name="select_day" value="{{ request.GET.select_day|default:today }}">
    <button type="submit">lọc</button>
    </form>
      <h3>Bảng chấm công nhân viên</h3>

        <table border="1" cellspacing="0" cellpadding="5">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Nhân viên</th>
                    <th>Chấm công</th>
                    <th>Trạng thái</th>
                </tr>
            </thead>
            <tbody>
                {% for s in staffs %}
                <tr>
                    <td>{{ s.id }}</td>
                    <td>{{ s.username }}</td>
                    <td>
                    <form method="POST">
                        {% csrf_token %}
                        <input type="hidden" name="staff_id" value="{{ s.id }}">
                        <input type="hidden" name="select_day" value="{{ select_day }}">
                        <button type="submit" name="trangthai" value="chamcong">Chấm công</button>
                        <button type="submit" name="trangthai" value="vang">Vắng</button>
                    </form>
                    </td>
                    <td>
                    {% if s.action == 'chamcong' %}
                        Chấm công
                    {% elif s.action == 'vang' %}
                        Vắng
                    {% else %}
                        Chưa chấm
                    {% endif %}
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="5" style="text-align:center;">Không có dữ liệu.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        </div>
    </div>


</div>
{% endblock %}


